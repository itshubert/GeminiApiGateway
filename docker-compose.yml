x-apiservice-env: &apiservice-env
  ASPNETCORE_ENVIRONMENT: Development
  DOTNET_USE_POLLING_FILE_WATCHER: "1"
  ASPNETCORE_URLS: "http://+:80;https://+:443"
  DOTNET_RUNNING_IN_CONTAINER: "true"
  DOTNET_SYSTEM_GLOBALIZATION_INVARIANT: "false"
  NUGET_XMLDOC_MODE: skip
  ASPNETCORE_Kestrel__Certificates__Default__Path: /https/aspnetapp.pfx
  ASPNETCORE_Kestrel__Certificates__Default__Password: ${CERTIFICATE_PASSWORD}

services:
  catalog:
    container_name: geminicatalog-api
    image: geminicatalog-api
    environment:
      <<: *apiservice-env
      ConnectionStrings__GeminiCatalogDbContext: ${GeminiCatalogDbContext}
    networks:
      - app-network
    ports:
      - "4000:80"
      - "4001:443"
    volumes:
      - ~/.aspnet/https:/https:ro

  customer:
    container_name: geminicustomer-api
    image: geminicustomer
    environment:
      <<: *apiservice-env
      ConnectionStrings__GeminiCustomerDbContext: ${GeminiCustomerDbContext}
    networks:
      - app-network
    ports:
      - "4004:80"
      - "4005:443"
    volumes:
      - ~/.aspnet/https:/https:ro

networks:
  app-network:
    driver: bridge
    external: true
